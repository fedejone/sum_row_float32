# Сумма ряда чисел float32 

В качестве открытой библиотеки, реализующей сложение float32 была выбрана https://github.com/nishthaparashar/Floating-Point-ALU-in-Verilog/tree/master/Addition%20and%20Subtraction.
Модуль реализует  сложения и вычитания числе с плавающей точкой. 


![](/doc/module.jpg)


 - **a_operand** и **b_operand**  - являются входными значениями 
- **AddBar_Sub** - Сигнал указатель сложения или вычитания (Сложение низкий уровень)
-  **result** - результат сложения 

### Изначально принималось две реализации модуля :
1) Стратегия последовательного сумматора 


![](/doc/shema1.jpg)


2) стратегия параллельного сумматора

![](/doc/shema.jpg)
**Значок + это  модуль Addition_Subtraction**

Последовательный сумматор реализовать проще и используемых ресурсов будет использоваться меньше, но количество тактов  сложения всего ряда будет **РАЗМЕР_РЯДА -1**

Поэтому было принято решение реализовать параллельный сумматор. Количесво тактов для сложения всего ряда будет равно **Log2(РАЗМЕР_РЯДА)**. Т.е. если **размер ряда равен 64 , результат будет получен на 6 такте**.


Так как приведенная на рисунке выше схема параллельного сумматора идеально подходит только для случая если ряд чисел содержит  2^N^ значений. В написанном модуле реализована система дополнения ряда нулями в случае если состоит не из 2^N^ значений.

Такой подход позволяет находить сумму ряда, **содержащего любое количество значений.**

### Для более оптимальной использования  ресурсов при выполнении арифметических действий используются DSP блоки. 
Способом использовать DSP ячейки является написание логики так, чтобы эта логика естественным образом ложилась на существующие в DSP ячейках аппаратные структуры. В этом случае САПР автоматически будет использовать DSP ячейки при синтезе. 

Т.к DSP ячейки отличаются в зависимости от библиотеки стандартных модулей, трудно написать дизайн, который бы на 100% подходил для нее. Так например некоторые регистры DSP блоков имеют синхронный сброс, что не реализовано в моем модуле. 

## Построковое комментирования модуля ***paralel_sum_float32***

- 20 - присвоение переменной ***data_reg*** увеличенного нулями в случае необходимости значения ряда   
- 24-25 - создание упакованных массивов для присвоения им промежуточных вычислений 
- 27-71 - генерация матрицы размером Log2(РАЗМЕР_РЯДА) х РАЗМЕР_РЯДА/2 выполняющей вычисления, по аналогии с рисунком параллельного сумматора 
- 31-48 - суммирование и запись в регистры первых значений 
- 50-71 - суммирование последующих значений, так же по аналогии с рисунком параллельного сумматора 
![](/doc/summa.jpg)
- 73 - присвоение результату итогового значения 
#
- Код проекта находится в папке *RTL*

- Тестбенч модуля находится в папке *tb*

- Скрипт для запуска симуляции проекта находится в папке sim\modelsim\float32\make_sim.bat

- Скрипт для запуска синтеза проекта находится в папке syn\Vivado\make_analyz.bat